using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;
using NewHirePortalClean.Data;
using NewHirePortalClean.Models;
using System.Linq;
using System.Threading.Tasks;

namespace NewHirePortalClean.Pages
{
    public class LoginModel : PageModel
    {
        private readonly AppDbContext _context;

        public LoginModel(AppDbContext context)
        {
            _context = context;
        }

        [BindProperty]
        public string Username { get; set; }

        [BindProperty]
        public string Password { get; set; }

        public async Task<IActionResult>
    OnPostAsync()
    {
    if (string.IsNullOrEmpty(Username) || string.IsNullOrEmpty(Password))
    {
    ModelState.AddModelError(string.Empty, "Username and Password are required.");
    return Page();
    }

    // Verify user credentials
    var user = _context.Users.FirstOrDefault(u => u.Username == Username && u.Password == Password);
    if (user == null)
    {
    ModelState.AddModelError(string.Empty, "Invalid login attempt.");
    return Page();
    }

    // Successful login
    HttpContext.Session.SetString("Username", user.Username);
    if (user.IsAdmin)
    {
    return RedirectToPage("/AdminPortal");
    }
    else
    {
    return RedirectToPage("/UserDashboard"); // Assuming there's a user dashboard
    }
    }
    }
    }
